# サンプリング手法 - 複数選択問題

## 問題
**サンプリング手法**の特徴と応用について、正しいものを**すべて**選択してください。

## 選択肢
A. Top-k サンプリングは固定数のトークンから選択するため、文脈に関係なく一定の多様性を提供する
B. Temperature パラメータは確率分布の形状を変更し、創造性と一貫性のトレードオフを制御する
C. Min-p サンプリングは最高確率トークンとの相対比率で閾値を設定するため、モデルの確信度に適応する
D. DRY（Don't Repeat Yourself）サンプリングは単純な単語レベルの繰り返しのみを防ぐ

## 正解
**B、C**

## 解説
サンプリング手法は、大規模言語モデルの出力品質と多様性を制御する重要な技術群です。各手法の特徴を正確に理解することが効果的な活用につながります。

**選択肢A（×）：Top-k サンプリングの特性**

**誤解の内容**
Top-k サンプリングが「一定の多様性」を提供するという記述は不正確です。

**実際の動作**
- **固定数選択**：常に上位k個のトークンから選択
- **文脈依存性**：確率分布の形状により実際の多様性は変動
- **問題点**：高確信時に不要な多様性、低確信時に不十分な選択肢

**具体例**
```
高確信時：「東京の首都は」→ 上位3つが「日本」「Japan」「にほん」
低確信時：「明日の天気は」→ 上位3つの確率が均等に分散
```

**選択肢B（○）：Temperature パラメータの効果**

**確率分布の変形メカニズム**
```
修正式：P'(x_i) = exp(logits_i / T) / Σ exp(logits_j / T)
```

**Temperature 値による影響**
- **T < 1.0**：分布の尖鋭化 → 決定論的・一貫性重視
- **T = 1.0**：元の分布を維持
- **T > 1.0**：分布の平坦化 → 創造的・多様性重視

**実用的なトレードオフ**
- **創造性 ↑**：新規性、意外性、表現の豊かさ
- **一貫性 ↓**：論理的整合性、文脈からの逸脱リスク

**選択肢C（○）：Min-p サンプリングの適応性**

**動的閾値設定の仕組み**
```
threshold = min_p × max_probability
```

**確信度に応じた適応**
- **高確信時（max_prob = 0.8）**：厳格な閾値（0.05 × 0.8 = 0.04）
- **低確信時（max_prob = 0.3）**：緩い閾値（0.05 × 0.3 = 0.015）

**従来手法との比較**
- **Top-p**：固定的な累積確率閾値
- **Top-k**：固定的なトークン数
- **Min-p**：文脈適応的な品質閾値

**選択肢D（×）：DRY サンプリングの高度な機能**

**実際の機能範囲**
DRY サンプリングは単純な単語繰り返し防止を超えた高度な機能を持ちます：

**n-gram パターン検出**
- **短いパターン**：「the the」（2-gram）
- **長いパターン**：「once upon a time」（4-gram）
- **文構造**：同じ文型の繰り返し

**動的ペナルティ調整**
- **パターン長に応じた指数的ペナルティ**
- **文脈ブレーカー（句読点等）の考慮**
- **最近の文脈に重点を置いた範囲制限**

**実装例**
```
検出パターン：「彼は走った。彼は」
→ 「走った」の繰り返しを予測してペナルティ適用
```

**最新の研究動向**

**2024年の重要な発展**
- **Min-p の標準化**：主要フレームワークでの採用
- **Top-N-Sigma**：統計的アプローチの改良
- **XTC（eXclude Top Choices）**：創造性向上のための新手法

**実用的な組み合わせ戦略**
- **創造的タスク**：Min-p + 高Temperature
- **事実的タスク**：低Temperature + Top-k
- **バランス型**：Min-p + 中Temperature + DRY

**学術的評価（ICLR 2025）**
Min-p サンプリングはICLR 2025で口頭発表として採択され、高温度設定での創造性と一貫性のバランスを効果的に実現する次世代技術として高く評価されています。DeepSeek R1等の最新推論モデルでも公式に推奨されており、実用性が実証されています。 